{% extends "base.html" %} 
{% load job_filters %}
{% load staticfiles %}
 
{% block extra_head %}
<script src="{% static 'job_details.js' %}"></script>
{% endblock %}

{% block content %}
<!-- {% if scheduled_date.all %} -->


{% regroup jobs by scheduled_date as jobs_by_date %}

<div class="container">
<ul class="collapsible" data-collapsible="accordion">
    {% for date in jobs_by_date %}
    <li>        
        <div class="collapsible-header active teal 
            {% if forloop.counter == 1 %}darken-4{% else %}darken-2{% endif %} white-text">
            {{ date.grouper }}
            <!-- <a href="#!" class="btn-floating btn-small waves-effect waves-light orange darken-2 right"><i class="material-icons">location_on</i></a>                 -->
            <!-- TODO: center icon and capture click?? -->
            <span class="new badge blue" data-badge-caption="">{{date.list|length }} 
                {% if date.list|length == 1 %}job{% else %}jobs{% endif %} / £{{ date.list|running_total }}</span>            
        </div>
        <div class="collapsible-body">
                <div class="row">
                    {% for job in date.list|dictsortreversed:"customer" %}                
                    <div>
                        <div class="card blue-grey darken-1 z-depth-3" id="card_{{ job.id }}">
                        <div class="card-content white-text">
                            <span class="card-title">{{ job.customer }}</span>
                            <div class="row">                                    
                            <div style="border-style: solid;  padding:5px">Price: £{{ job.price }}</div>
                            <div style="padding:5px"><span>{{ job.job_notes }}</span></div>
                            <div style="padding:5px"><span></span></div>
                        </div>
                        </div>
                        <div class="card-action">
                            <button id="{{ job.id }}" 
                                    class="compl_btn btn waves-effect waves-light"
                                         type="button" value="Click" 
                                         data_url='{% url "job_check_in" job.id %}'
                                         data_address = '{{ job.customer }}'
                                         data_payment = 'paid'
                                         >Completed/Paid</button>
                            <button class="compl_owed btn waves-effect waves-light" type="button" value="Click" data_url>Completed/Owed</button>
                            <a class="btn-floating  waves-effect waves-light teal accent-4 right"><i class="material-icons">more_horiz</i></a>
                        </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
        </div>
    </li>
    {% endfor %}
</ul>
</div>

<!-- Modal to confirm checkin -->
<div id="confirmation_modal" class="modal bottom-sheet">
    <div class="modal-content">
        <div id="modal_address"><h5>Address</h5></div>
        <p id="modal_message">Job has been checked in as completed/paid</p>
    </div>
    <div class="modal-footer">
        <a href="#!" id="modal_btn" class="btn modal-action modal-close waves-effect waves-green">OK</a>
    </div>
</div>
<!-- {% else %} -->
<div class="row" id="alert_box">
        <div class="col s12 m12">
            <div class="card teal lighten-4">
                <div class="row">
                    <div class="col s12 m10">
                        <div class="card-content">
                            <h5>There are no jobs to show</h5>
                        </div>
                    </div>                    
                </div>
            </div>
        </div>
    </div>
<!-- {% endif %} -->
{% endblock %}
{% block extra_js %}
<!-- SCRIPTS -->
<script src="{% static 'complete_job.js' %}"></script>    
{% endblock %}
